<!DOCTYPE html>
<html lang="km">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="../../images/rupp_logo.png" />
    <title id="profile-name-title">គណនី</title>
    <link rel="stylesheet" href="profile.css" />
  </head>
  <body>
    <header>
      <div class="header-container">
        <div class="logo">
          <a href="/"
            ><img src="../../images/rupp_logo.png" alt="រូបសញ្ញា RUPP"
          /></a>
          <div class="logo-text">
            <h1>សាកលវិទ្យាល័យភូមិន្ទភ្នំពេញ</h1>
            <p>នាយកដ្ឋានបច្ចេកវិទ្យាព័ត៌មាន</p>
          </div>
        </div>
        <nav>
          <ul>
            <li><a href="#home" class="active">ទំព័រដើម</a></li>
            <li><a href="#about">អំពីយើង</a></li>
            <li><a href="#services">សេវាកម្ម</a></li>
            <li><a href="#team">ក្រុមការងារ</a></li>
            <li><a href="#contact">ទំនាក់ទំនង</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <section class="profile-section">
        <div class="profile-container">
          <div class="profile-header">
            <img
              src="../../images/profile.png"
              alt="Profile Picture"
              class="profile-picture"
              id="profile-picture"
            />
            <h2 class="profile-name" id="profile-name">សុផេង</h2>
            <p class="profile-major" id="profile-major">វិស្វកម្មកម្មវិធី</p>
          </div>
          <div class="profile-details">
            <h3>ព័ត៌មានផ្ទាល់ខ្លួន</h3>
            <ul>
              <li>
                <strong>ឈ្មោះខ្មែរ:</strong> <span id="khmer-name">សុផេង</span>
              </li>
              <li>
                <strong>ឈ្មោះឡាតាំង:</strong>
                <span id="latin-name">Sokpheng</span>
              </li>
              <li>
                <strong>ឪពុក:</strong> <span id="father-name">សុផេង</span>
              </li>
              <li>
                <strong>ម្តាយ:</strong> <span id="mother-name">សុផេង</span>
              </li>
              <li>
                <strong>ថ្ងៃខែឆ្នាំកំណើត:</strong>
                <span id="date-of-birth">១ មករា ១៩៨០</span>
              </li>
              <li>
                <strong>ទីកន្លែងកំណើត:</strong>
                <span id="place-of-birth">ភ្នំពេញ</span>
              </li>
              <li>
                <strong>អ៊ីមែល:</strong>
                <span id="school-email">sokha.meas@example.com</span>
              </li>
              <li>
                <strong>លេខទូរស័ព្ទ:</strong>
                <span id="phone-number">0123456789</span>
              </li>
              <li>
                <strong>មុខវិជ្ជា:</strong>
                <span id="major">វិស្វកម្មកម្មវិធី</span>
              </li>
              <li><strong>ភេទ:</strong> <span id="gender">ប្រុស</span></li>
              <li>
                <strong>គណនីផុតកំណត់:</strong>
                <span id="expired_date">02-21-2025</span>
              </li>
              <!-- <li><strong>លេខសម្ងាត់:</strong> <span id="password">********</span></li> -->
            </ul>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-container">
        <div class="footer-column">
          <h3>តំណភ្ជាប់រហ័ស</h3>
          <ul>
            <li><a href="#home">ទំព័រដើម</a></li>
            <li><a href="#about">អំពីយើង</a></li>
            <li><a href="#services">សេវាកម្ម</a></li>
            <li><a href="#team">ក្រុមការងាររបស់យើង</a></li>
            <li><a href="#contact">ទំនាក់ទំនង</a></li>
            <li><a href="register-it.html">ចុះឈ្មោះ</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>ធនធានបច្ចេកវិទ្យាព័ត៌មាន</h3>
          <ul>
            <li><a href="#">អ៊ីមែលនិស្សិត</a></li>
            <li><a href="#">ប្រព័ន្ធគ្រប់គ្រងការសិក្សា</a></li>
            <li><a href="#">ធនធានបណ្ណាល័យ</a></li>
            <li><a href="#">ទាញយកកម្មវិធី</a></li>
            <li><a href="#">គោលនយោបាយបច្ចេកវិទ្យាព័ត៌មាន</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>ការគាំទ្រ</h3>
          <ul>
            <li><a href="#">ផ្នែកជំនួយបច្ចេកវិទ្យាព័ត៌មាន</a></li>
            <li><a href="#">ស្ថានភាពបណ្តាញ</a></li>
            <li><a href="#">កំណត់ពាក្យសម្ងាត់ឡើងវិញ</a></li>
            <li><a href="#">សំណួរដែលសួរញឹកញាប់</a></li>
            <li><a href="#">រាយការណ៍អំពីបញ្ហា</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>ភ្ជាប់ទំនាក់ទំនងជាមួយយើង</h3>
          <div class="social-links">
            <a href="#" class="social-link">FB</a>
            <a href="#" class="social-link">TW</a>
            <a href="#" class="social-link">IG</a>
            <a href="#" class="social-link">LI</a>
            <a href="#" class="social-link">YT</a>
          </div>
          <p style="margin-top: 1rem">
            ចុះឈ្មោះជាវព្រឹត្តិបត្ររបស់យើងសម្រាប់ព័ត៌មានថ្មីៗ
            និងសេចក្តីជូនដំណឹងផ្នែកបច្ចេកវិទ្យាព័ត៌មាន។
          </p>
        </div>
      </div>
      <div class="copyright">
        <p>
          &copy; ២០២៥ នាយកដ្ឋានបច្ចេកវិទ្យាព័ត៌មាននៃសាកលវិទ្យាល័យភូមិន្ទភ្នំពេញ។
          រក្សាសិទ្ធិគ្រប់យ៉ាង។
        </p>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const uuid = urlParams.get("id");

        if (!uuid) {
          window.location.href = "../not-found.html"; // Redirect if no uuid is provided
          return;
        }
        if (uuid) {
          fetch("../../php/service/fetch_user.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: `uuid=${uuid}`,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                // Populate profile details with fetched data
                document.getElementById("khmer-name").textContent =
                  data.khmer_name;
                document.getElementById("profile-name").textContent =
                  data.khmer_name;
                document.getElementById("profile-name-title").textContent =
                  "គណនី - " + data.khmer_name;
                document.getElementById("latin-name").textContent =
                  data.latin_name;
                document.getElementById("father-name").textContent =
                  data.father_name;
                document.getElementById("mother-name").textContent =
                  data.mother_name;
                document.getElementById("date-of-birth").textContent =
                  data.date_of_birth;
                document.getElementById("place-of-birth").textContent =
                  data.place_of_birth;
                document.getElementById("school-email").textContent =
                  data.school_email || "Not provided";
                document.getElementById("phone-number").textContent =
                  data.phone_number;
                document.getElementById("major").textContent = data.major;
                document.getElementById("profile-major").textContent =
                  data.major;
                document.getElementById("gender").textContent = data.gender;
                document.getElementById("expired_date").textContent =
                  data.expired_date || "02-21-2025";

                var currentDate = new Date();
                var expiredDate = new Date(data.expired_date);
                // Check if the account has expired
                if (expiredDate < currentDate) {
                  alert("⚠️ គណនីរបស់អ្នកបានផុតកំណត់!");
                  window.location.href = "../not-found.html"; // Redirect on error
                  return; // Prevent form submission if expired
                }

                // If you have a profile image URL, you can also update the profile picture
                if (data.profile) {
                  document.querySelector(".profile-picture").src = data.profile;
                }
              } else {
                console.error("User not found");
                window.location.href = "../not-found.html"; // Redirect on error
              }
            })
            .catch((error) => {
              console.error("Error fetching user data:", error);
            });
        }
      });
    </script>
  </body>
</html>
